# k8s

*참고 : [https://subicura.com/2019/05/19/kubernetes-basic-1.html#쿠버네티스란](https://subicura.com/2019/05/19/kubernetes-basic-1.html#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EB%9E%80)*

## 1. 기본 개념

### **Desired state**

### **구성 요소**

### **Pod**

쿠버네티스에서 배포할 수 있는 가장 작은 단위

한 개 이상의 컨테이너와 스토리지, 네트워크 속성을 가집니다. 

Pod에 속한 컨테이너는 스토리지와 네트워크를 공유하고 서로 localhost로 접근할 수 있습니다.

컨테이너를 하나만 사용하는 경우도 반드시 Pod으로 감싸서 관리합니다.

 

### **ReplicaSet**

Pod을 여러 개 복제하여 관리하는 오브젝트

ReplicaSet은 복제할 개수, 개수를 체크할 라벨 선택자, 생성할 Pod의 설정값(템플릿)등을 가지고 있습니다. 

직접적으로 ReplicaSet을 사용하기보다는 Deployment등 다른 오브젝트에 의해서 사용되는 경우가 많습니다.

### **Service**

네트워크와 관련된 오브젝트

Pod을 외부 네트워크와 연결해주고, 여러 개의 Pod을 바라보는 내부 로드 밸런서를 생성할 때 사용

내부 DNS에 서비스 이름을 도메인으로 등록하기 때문에 서비스 디스커버리 역할도 합니다.

### **Volume**

저장소와 관련된 오브젝트

호스트 디렉토리를 그대로 사용할 수도 있고 EBS 같은 스토리지를 동적으로 생성하여 사용할 수도 있습니다. 

사실상 인기 있는 대부분의 저장 방식을 [지원](https://kubernetes.io/docs/concepts/storage/#types-of-volumes)합니다.

### **배포 방식**

중앙(Master)에 API 서버와 상태 저장소를 두고 각 서버(Node)의 에이전트(kubelet)와 통신하는 구조

---

## 2. **아키텍처**

### **마스터 - 노드 구조**

쿠버네티스는 전체 클러스터를 관리하는 **마스터**와 컨테이너가 배포되는 **노드**로 구성되어 있습니다.

모든 명령은 마스터의 API 서버를 호출하고 노드는 마스터와 통신하면서 필요한 작업을 수행합니다.

특정 노드의 컨테이너에 명령하거나 로그를 조회할 때도 마스터에 명령을 내리고 마스터가 노드에 접속하여 대신 결과를 응답

에이전트(kubectl) → 마스터 → 노드 → 마스터 → 에이전트(kubectl)

### **Master**

다양한 모듈이 확장성을 고려하여 기능 별로 쪼개져 있는 것이 특징

관리자만 접속할 수 있도록 보안 설정을 해야 함

마스터 서버가 죽으면 클러스터를 관리할 수 없기 때문에 보통 3대를 구성하여 안정성을 높임

### **Node**

노드 서버는 마스터 서버와 통신하면서 필요한 Pod을 생성하고 네트워크와 볼륨을 설정

실제 컨테이너가 생성되는 곳 

### **Kubectl**

API 서버는 json 또는 protobuf 형식을 이용한 http 통신을 지원함

이 방식을 그대로 쓰면 불편하므로 보통 `kubectl`이라는 명령행 도구를 사용

## 2-1. Master 구성 요소

### API 서버 (kube-apiserver)

API 서버는 모든 요청을 처리하는 마스터의 핵심 모듈

kubectl의 요청 뿐 아니라 내부 모듈의 요청도 처리, 권한을 체크하여 요청 거부도 가능

실제로 하는 일은 원하는 상태를 key-value 저장소에 저장하고 저장된 상태를 조회하는 것

### 분산 데이터 저장소 (etcd)

### 스케줄러

### 컨트롤러

![하나의 Pod이 생성되는 과정](k8s%2075c926f46a284ef3a2e2634720d956e2/Untitled.png)

하나의 Pod이 생성되는 과정

 

[Pod](k8s%2075c926f46a284ef3a2e2634720d956e2/Pod%20c9564e8a14e543dfa0ac8bdc93a820ca.md)

[레이블과 셀렉터](k8s%2075c926f46a284ef3a2e2634720d956e2/%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%80%E1%85%AA%20%E1%84%89%E1%85%A6%E1%86%AF%E1%84%85%E1%85%A6%E1%86%A8%E1%84%90%E1%85%A5%20a80be457f73b4d67811cfb2f36f88ab2.md)